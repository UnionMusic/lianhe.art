app: lianheart
stage: prod
component: nextjs
name: website

inputs:
  src:
    hook: npm run build
    dist: ./
    exclude:
      - .env
      - 'node_modules/**'
      - .git**
      - .github
      - cloudfunctions
      - cdn
      - cos
      - layer
      - .all-contributorsrc
      - .editorconfig
      - .eslintrc.js
      - .prettierrc
      - .releaserc
      - .stylelintrc
      - CHANGELOG.md
      - CODEOWNERS
      - LICENSE*
      - netlify.toml
      - README.md
      - serverless.yml
  region: ap-shanghai
  functionConf:
    name: ${app}-${name}
    runtime: Nodejs12.16
    memorySize: 128
    environment:
      variables:
        STATIC_URL: https://static.lianhe.art
        NODE_ENV: production
  apigatewayConf:
    name: ${app}_${name}
    protocols:
      - https
    environment: release
  layers:
    - name: ${output:${stage}:${app}:layer.name}
      version: ${output:${stage}:${app}:layer.version}
  staticConf:
    cosConf:
      bucket: ${output:${stage}:${app}:cos.bucket}
      sources:
      - src: dist/static
        targetDir: /_next/static
      - src: public
        targetDir: /
    cdnConf:
      onlyRefresh: true
      domain: ${output:${stage}:${app}:cdn.domain}